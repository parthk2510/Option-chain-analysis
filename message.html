<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      h1 {
        text-align: center;
        margin-top: 20px;
      }

      form {
        text-align: center;
        margin-bottom: 20px;
      }

      table {
        margin: 0 auto;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 8px;
        text-align: center;
        border: 1px solid #ddd;
      }

      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <h1>Option Chain</h1>
    <form>
      <select id="symbol-select" name="symbol">
        <option value="">All</option>
        <option value="MAINIDX">MAINIDX</option>
        <option value="FINANCIALS">FINANCIALS</option>
      </select>
    </form>
    <table id="data-table"></table>

    <script>
      function getData() {
        var symbol = $("#symbol-select").val();

        $.ajax({
          url: "http://127.0.0.1:5000/data",
          method: "GET",
          data: { symbol: symbol },
          success: function (response) {
            console.log(response);
            updateDataList(response);
          },
          error: function (xhr, status, error) {
            console.log(error);
          },
        });
      }

      function updateDataList(data) {
        var dataTable = $("#data-table");
        dataTable.empty();

        var tableHeader = `
          <tr>
            
            <th>Expiry Date</th>
            <th>Option Type</th>
            <th>Strike Price</th>
            <th>Last Traded Price</th>
            <th>OI</th>
            <th>Change in OI</th>
            <th>Volume</th>
            <th>IV</th>
            <th>Bid Qty</th>
            <th>Bid</th>
            <th>Ask</th>
            <th>Ask Qty</th>
            <th>Net Change</th>
          </tr>`;

        dataTable.append(tableHeader);

        data.forEach(function (item) {
          var row = `
            <tr>
              
              <td>${item.date}</td>
              <td>${item.option}</td>
              <td>${item.strikePrice}</td>
              <td>${item.LTP}</td>
              <td>${item.openInterest}</td>
              <td>${item.changeInOI}</td>
              <td>${item.totalTradedVolume}</td>
              <td>${item.iv}</td>
              <td>${item.bestBidQty}</td>
              <td>${item.bestBid}</td>
              <td>${item.bestAsk}</td>
              <td>${item.bestAskQty}</td>
              <td>${item.netChange}</td>
            </tr>`;

          dataTable.append(row);
        });
      }

      // Event listener for dropdown menu change
      $("#symbol-select").change(function () {
        getData();
      });

      // Poll for updates every 5 seconds
      setInterval(getData, 5000);

      // Initial data retrieval
      getData();
    </script>
  </body>
</html>